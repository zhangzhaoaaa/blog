<!DOCTYPE html>
<html> 
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title></title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    </head>
    <body>
        <p>Hello world! This is HTML5 Boilerplate.</p>

		<script>
		    //module 1.
		 	var myModule=function(){
		 		var willGoto=function(local){
		 			console.log("I want to go to "+local);
		 		};
		 		var beenGone=function(local){
		 			console.log("I has gone to "+local);
		 		};
		 		return {
		 			willGo:function(local){
		 				willGoto(local);
		 			},
		 			beenGo:function(local){
		 				beenGone(local);
		 			}
		 		}
		 	}();

		 	myModule.willGo("beijing");
		 	myModule.beenGo("beijing");


		 	//module 2
		 	var workModule={};
		 	(function(exports){
		 		var tools = ['bus','computer','gun','pen'];
		 		exports.bySubway=function(){
		 			console.log('I go to work by subway');
		 		}

		 		exports.work=function(tool){
		 			console.log('I do my job by ',tools[tool]);
		 		}

		 		exports.whichTool=function(tool){
		 			return tools.indexOf(tool);
		 		}

		 	})(workModule);

		 	workModule.bySubway();
		 	workModule.work(workModule.whichTool('computer'));

		 	//module 3

		 	var defineCache=Object.create(null);
		 	var currentMod = null;
		 	function backgroundReadFile(url, callback) {
			    var header = document.getElementsByTagName('head')[0];
			    var script = document.createElement('script');
				script.src = url + '.js';
				script.async = true;
				if (script.readyState) {
					script.onreadystatechange = innerOnload;
				}else {
					script.onload = innerOnload;
				}

				function innerOnload() {
					var readyState = script.readyState;
					if (typeof readyState === 'undefined'|| /^(loaded|complete)$/.test(readyState)) {
						script.onload = script.onreadystatechange = null;
						script = null;
						//onload();
					}
				}
				callback();
				header.appendChild(script);
			};

		 	function getModule(name){
		 		if (name in defineCache){
		 			return defineCache[name];
		 		}

		 		var module = {
		 			exports:null,
		 			loaded:false,
		 			onLoad:[]
		 		};

		 		defineCache[name] = module;
				/*backgroundReadFile(name, function(code) {
				        currentMod = module;
				        new Function("", code)();
				});*/
				return module;
		 	};

		 	function define(depNames,moduleFunction){
		 		var myMod = {};
		 		var deps = depNames.map(getModule);

		 		deps.forEach(function(mod){
		 			if (!mod.loaded){
		 				mod.onLoad.push(whenDepsLoaded);
		 			}
		 		});

		 		function whenDepsLoaded(){
		 			/*if (!deps.every(function(m){return m.loaded;})){
		 				return;
		 			}*/

		 			var args = deps.map(function(m){return m.exports;});

		 			var exports = moduleFunction.apply(null,args);
		 			//deps.map(function(m){return m.exports=exports;});
	 				myMod.exports = exports;
	 				myMod.loaded = true;

	 				//myMod.onLoad.forEach(function(f){f();});
		 		}

		 		whenDepsLoaded();
		 		defineCache[depNames[0]] = myMod.exports;
		 		return myMod.exports;
		 	}

		 	function use(deps,factory){
		 		var currentMod=null;
		 		deps.forEach(function(name){
		 			defineCache[name]!=undefined?currentMod=defineCache[name]:"";
		 			return;
		 		});
		 		factory(currentMod);

		 	}
		    define(["workDay"], function (weekDay) {
        			//console.log(weekDay.name(1));
        			//document.write(weekDay.name(1));
        			console.log('define....');
        			return "workDay";
    		});

    		use(["workDay"],function(workDay){
    			console.log("My ",workDay);
    		});
		</script>
    </body>
</html>