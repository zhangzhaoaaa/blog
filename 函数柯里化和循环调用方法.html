<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <script>
        /*在计算机科学中，柯里化（英语：Currying），又译为卡瑞化或加里化，是把接受多个参数的函数变换成接受一个单一参数（最初函数的第一个参数）的函数，并且返回接受余下的参数而且返回结果的新函数的技术。这个技术由 Christopher Strachey 以逻辑学家哈斯凯尔·加里命名的，尽管它是 Moses Sch?nfinkel 和 戈特洛布·弗雷格 发明的。
        在直觉上，柯里化声称“如果你固定某些参数，你将得到接受余下参数的一个函数”。所以对于有两个变量的函数，如果固定了 ，则得到有一个变量的函数 。*/
        /*当发现正在调用同一个函数，并且传递的参数绝大多数是相同的，那么该函数可能是用于curry化的一个很好的候选参数，可以通过将函数集合部分应用到函数中，从而动态创建一个新函数，这个新函数将会保存重复的参数，并且还会使用预填充原始函数所期望的完整列表。
        curry化就是用闭包原理实现函数参数的合并，然后再运行函数。*/
        function curry(fn){
            var args = [].slice.call(arguments,1);
            return function(){
                var newArgs = [].slice.call(arguments);
                var sArray = newArgs.concat(args);
                return fn.apply(null,sArray);
            }
        }

        function addTest(a,b){
            return a+b;
        }

        var adds=curry(addTest,1);
        console.log(adds(2,3));//6

        //递归调用
        /*var curry= function(fn){//原函数的参数为函数
            return function(args){//内部函数的参数为数组，由于立即执行，因此直接到第三重去
                //args是相对于第三重内部函数可是全局变量
                var self= arguments.callee;//把自身保存起来（就是那个数组为参数的第二重函数）
                return function(){ //这才是第二次调用的函数
                    if(arguments.length){//如果还有要添加的参数
                        [].push.apply(args,arguments);//apply把当前传入的所有参数放进args中
                        return self(args);
                    }else{
                        return fn.apply(this,args);//apply的第二参数为数组
                    }
                }
            }([]);
        };
        function sum(){
            var result=0;
            for(var i=0, n=arguments.length; i<n; i++){
                result += arguments[i];
            }
            return result;
        }

        var sum2= curry(sum);
        sum2= sum2(1)(2);

        console.log(sum2());*/

        //非柯里化，只是递归返回，并覆盖函数的toString方法
        function add(num){
            var value=0;
            value+=num;
            function plus(num){
                value+=num;
                return plus;
            }

            plus.valueOf=function(){
                return value;
            }

            plus.toString=function(){
                return value.toString();
            }

            return plus;
        }

        console.log(add(10)(15));//25
        console.log(add(1)(5));//6
    </script>
    <script>
	//1. 参数复用；2. 提前返回；3. 延迟计算/运行。
		var smallKenan = function(action) {
		    var bigKenan = function(doing) {
		        var result = "";
		        if (action === "take drugs") {
		            if (doing === "bathWithGirlFriend") {
		                result = "尖叫，新一，你这个色狼，然后一巴掌，脸煮熟了~";
		            } else if (doing === "pointOutKiller") {
		                result = "新一，这个案子就交给你的，快点找出谁是凶手吧~";
		            }
		        } else {
		            if (doing === "bathWithGirlFriend") {
		                result = "来吧，柯南，一起洗澡吧~";
		            } else if (doing === "pointOutKiller") {
		                result = "小孩子家，滚一边去！";
		            }
		        }
		        console.log(result);
		        return arguments.callee; // 等同于return bigKenan
    	  };
    return bigKenan;
};

// 小柯南吃药了，然后和毛利兰洗澡，凶案现场指证犯人；结果是……
smallKenan("take drugs")("bathWithGirlFriend")("pointOutKiller");

function update(item){
	return function(content){
		$('#'+item).html(content);
	}
}	

function refresh(url,callback){
 	var params = {
        type : "echo",
        data : ""
    };
    $.ajax({
        type:"post",
        url:url,
        cache:false,
        async:true,
        dataType:"json",
        data:params,
        //当异步请求成功时调用
        success: function(data, status){
            callback(data);
        },
        //当请求出现错误时调用
        error: function(err){
            alert("error : "+err);
        }
    });
}

//refresh("action.do?target=news", update("newsPanel"));
//refresh("action.do?target=articles", update("articlePanel"));
//refresh("action.do?target=pictures", update("picturePanel"));

var add2 = function(num1){
	var value=0;
	value+=num1;
	var addSum=function(num2){
		value+=num2;
		return arguments.callee;
	}
	addSum.toString=function(){
		return value.toString();
	}
	return addSum;
}

console.log(add2(1)(2)(3));
	</script>
</head>
<body>

</body>
</html>
